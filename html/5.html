<!DOCTYPE HTML >
<html>
<head>
<title>设置</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<link rel="stylesheet" href="css/base_style.css" type="text/css" />
</head>
<body bgcolor="#F0F0F0">

<div class="banner">
		<h1>设置</h1>
		<a class="btna" href="Login.html" id="login_none" >
			<div class="refreshbtnbg" >登录</div>
		</a>
		<a class="btna" href="UpdPass.html" id="login_had" style="display: none;">
			<div class="refreshbtnbg" >密码</div>
		</a>
</div>
	<div class="set_content">
	<div id="loading" class="youxi_tishi" style="display:none">正在加载...</div>
		<div id="content" class="set_main set_height">
			<div id="woringLeve" style="display: none;">
				<a href="http://wedanke.com/software/downloadSoft/1">请点击下载最新版</a>
			</div>
			<div id="latest">
				您已经是最新版本了(<span id="versionName"></span>)
			</div>
		</div>		

		<div class="set_main" id="login_in_div" style="display: none;">
		<div class="set_xian set_height" onclick="edit(1)">个人资料<span class="set_btn" onclick="edit(1)">编辑</span></div>
		<div class="set_xian set_height" onclick="edit(3)">留言信箱<span class="mess_num set_munwz" id="message_num">0</span></div>
		<div class="set_xian set_height" onclick="window.location.href='order.html'">我的商品订单</div>
		<div class="set_height" onclick="logout()">退出账号</div>
		</div>
		
		<div class="set_main">
		<div class="set_xian set_height" onclick="window.location.href='lct.html'">购物帮助</div>
		<div class="set_xian set_height" onclick="window.myAndroidJs.cleanCache('1');">清除缓存</div>
		<div class="set_height" onclick="window.location.href='about.html'">关于</div>		
		</div>
		
		<div align="center" style="padding-top:6px;width:100%;margin-bottom: 15px;" class="main">
			<span style="font-size: 16">更多精品应用推荐</span>
		</div>
		<div style="height:90px;font-size: 14px;margin-bottom: 78px;" id="soft_apk">
		
		</div>
		<br>
		<br>
	</div>
<script type="text/javascript" src="js/bottom.js"></script>
<script src="js/jq.js"></script>
<script src="js/jquery.common.js"></script>
<script type="text/javascript">
var versionCode;
var versionName;
//DOM加载完成后初始化客户端参数
document.addEventListener('DOMContentLoaded', function(){
try{
	versionCode = window.myAndroidJs.getVersionCode();
	versionName = window.myAndroidJs.getVersionName();
}catch (e) {
}

if(versionCode != 50){
	document.getElementById("woringLeve").style.display = 'block';
	document.getElementById("latest").style.display = 'none';
}
document.getElementById("versionName").innerHTML = versionName; 
});

function edit(n){
	if(n == 1){
		window.location.href='setting_info.html';
	}else if(n == 2){

	}else if(n == 3){
		window.location.href='message_box.html';
	}
}

function logout(){
	window.localStorage.setItem("_user_id",'');
	window.localStorage.setItem("_remember_me",'');
	window.localStorage.setItem("_user_pwd",'');
	window.location.reload();
}
function getMsgNum(){
	var u_id = window.localStorage.getItem("_user_id");
	if(u_id == null || u_id == undefined || u_id == ''){
		return ;
	}
	var result="";
  	try{
  		result = window.myAndroidJs.doPostHttpRequest($.get_path("market?type=166&userId="+u_id+""))
  	}catch (e) {

	}
	if(result!="")
	{
		//result = eval('('+ result +')');
		result = JSON.parse(result);
		if(result.result == 1){
			var num = parseInt(result.data.num);
			$("#message_num").text(num > 9 ? 'N' : num);
		}
	}	
}

$(function(){
	$.show_shopping_cart_num($.get_path());
	$.doClearHistory();
	$.loadLoginStatus();
	setTimeout(getSoftApk);
	var u_id = window.localStorage.getItem("_user_id");
	if(u_id == null || u_id == undefined || u_id == ''){
		$("#login_in_div").hide();
		return ;
	}else{
		$("#login_in_div").show();
		$("#userId").val(u_id);
		getMsgNum();
		setInterval("getMsgNum()",4000);
	}
});
function woringWait(woringText,packageName,apkUrl,name,id){
	document.getElementById("loading").style.display = 'block';
	var result="";
  	try{
  		result = window.myAndroidJs.doPostHttpRequest($.get_path("market?type=168&id="+id+"&activateNumber="+window.myAndroidJs.getActivateNumber()+"&readType=gengduo&channel="+window.myAndroidJs.getChannel()+""))
  	}catch (e) {
	}	
	window.myAndroidJs.openThreeApp(woringText,packageName,apkUrl,name);

	setTimeout("noneDiv()",1500);
}
function noneDiv(){
	document.getElementById("loading").style.display = 'none';
}
function getSoftApk(){
	var result="";
  	try{
  		result = window.myAndroidJs.doPostHttpRequest($.get_path("market?type=172"))
  	}catch (e) {
	}
	if(result!="")
	{
		//result = eval('('+ result +')');
		result = JSON.parse(result);
		if(result.result == 1){
			var arr = new Array();
			for ( var index in result.data) {
				var soft = result.data[index];
				arr.push("<div onclick=\"woringWait('亲 ！您还没有安装此应用,确定要安装吗?','");	
				arr.push(soft.packageName);	
				arr.push("','http://res.paitao.com:8080/client/upload/software/");	
				arr.push(soft.url);	
				arr.push("','");	
				arr.push(soft.name);	
				arr.push("',");	
				arr.push(soft.softId);	
				arr.push(");\" style=\"float: left;width:25%;text-align: center;\">");	
				arr.push("<img src=\"");	
				arr.push(soft.icon);	
				arr.push("\"  style=\"width:60px;\" />");	
				arr.push("<br><span>");	
				arr.push(soft.name);
				arr.push("</span></div>");	
			}
			$("#soft_apk").html(arr.join(""));
		}
	}	
}
</script>
</body>
</html>