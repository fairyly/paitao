<!DOCTYPE HTML>
<html> 
<head>
<title>留言信箱</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<link rel="stylesheet" href="css/base_style.css" type="text/css" />
</head>
<body>
<div class="banner">
	<h1>留言信箱</h1>
	<a class="btnr">
		<div onclick="history.go(-1);" >返回</div>
	</a>
	<a class="btna" href="javascript:location.reload();">
		<div class="refreshbtnbg">刷新</div>
	</a>
</div>

<!-- 如果留言板有内容 这块内容不显示 -->
<div class="gwc_kong" id="message_none_div" style="display:none">
	<div><img src="img/paitaoicon2.png" /></div>
	<div class="gwc_kongp">您的留言信箱是空的</div>
</div>
<div class="mess_list" id="list_div">
</div>

<script src="js/jq.js"></script>
<script src="js/jquery.common.js"></script>
<script type="text/javascript">
function goto_board(type,id,channelId){
	if(type == 1){
		window.localStorage.setItem("message_talk.html",'message_talk.html?orderId='+id+'&channelId='+channelId);
		//window.location.href='message_talk.html?orderId='+id+'&channelId='+channelId;
		window.location.href='message_talk.html';
	}else if(type == 2){
		window.localStorage.setItem("message_talk.html",'message_talk.html?commodityId='+id+'&channelId='+channelId);
		//window.location.href='message_talk.html?commodityId='+id+'&channelId='+channelId;
		window.location.href='message_talk.html';
	}
}
function hide_board(type,id,channelId,remove_id){
	if(!window.confirm("您确定要删除该信息吗?")){
		return ;
	}
	var u_id = window.localStorage.getItem("_user_id");
	if(u_id == null || u_id == undefined || u_id == ''){
		if(window.confirm("请先登录")){
			window.location.href='Login.html';
		}
		return ;
	}else{
		var result="";
		if(type == 1){
		  	try{
		  		result = window.myAndroidJs.doPostHttpRequest($.get_path("market?type=167&userId="+u_id+"&channelId="+channelId+"&orderId="+id+""))
		  	}catch (e) {

			}
		}else if(type == 2){
			try{
		  		result = window.myAndroidJs.doPostHttpRequest($.get_path("market?type=167&userId="+u_id+"&channelId="+channelId+"&commodityId="+id+""))
		  	}catch (e) {

			}
		}
		if(result!="")
		{
			result = eval('('+ result +')')
			if(result.result == "1"){
				if(result.data.result == 'noparam'){
					//alert('参数有误');
					return ;
				}else {
					$("#"+remove_id).remove();		
					if($("#list_div").children("div[class='good2G good']").length < 1){
						$("#message_none_div").show();
					}
				}
			}
		}
	}
}

function get_board_list(){
	var u_id = window.localStorage.getItem("_user_id");
	if(u_id == null || u_id == undefined || u_id == ''){
		return ;
	}
	var result="";
  	try{
  		result = window.myAndroidJs.doPostHttpRequest($.get_path("market?type=179&userId="+u_id+""))
  	}catch (e) {
  		$.getJSON("http://api.wedanke.com/server/market?jsoncallback=?",{
		   type : 179,
		   userId : u_id
		},function(result){
			if(result.result == 1){
				if(result.data.boardList.length < 1){
					$("#message_none_div").show();
				}else{
					var arr = new Array("");
					for( var i in result.data.boardList){
						var board = result.data.boardList[i];
						if(board.orderId != null){
							arr.push('<div class="good2G good" id="_msg_board'+board.id+'">');
							arr.push('<div class="in_goodimg" onclick="goto_board(1,\''+board.orderId+'\',\''+board.channelId+'\');">');
							arr.push('<img src="'+board.commodityIcon+'">');
							arr.push('<span class="mess_num mess_munwz">'+$.num_N(board.unReadNum)+'</span>');
							arr.push('</div>');
							arr.push('<div class="in_gooddescribe" onclick="goto_board(1,\''+board.orderId+'\',\''+board.channelId+'\');">');
							arr.push('<div class="goodtit">');
							arr.push('<b>'+board.commodityName+'</b>');
							arr.push('</div>');
							arr.push('<div class="mess_pl">'+board.replayContent+'</div>');
							arr.push('<div class="mess_pl mess_time">'+board.replayTime.substr(0,10)+'</div>');
							arr.push('</div>');
							arr.push('<div class="btnbuy" onclick="hide_board(1,\''+board.orderId+'\',\''+board.channelId+'\',\'_msg_board'+board.id+'\');">删除</div>');
							arr.push('</div>');
						}else{
							arr.push('<div class="good2G good" id="_msg_board'+board.id+'">');
							arr.push('<div class="in_goodimg" onclick="goto_board(2,\''+board.commodityId+'\',\''+board.channelId+'\');">');
							arr.push('<img src="'+board.commodityIcon+'">');
							arr.push('<span class="mess_num mess_munwz">'+$.num_N(board.unReadNum)+'</span>');
							arr.push('</div>');
							arr.push('<div class="in_gooddescribe" onclick="goto_board(2,\''+board.commodityId+'\',\''+board.channelId+'\');">');
							arr.push('<div class="goodtit">');
							arr.push('<b>'+board.commodityName+'</b>');
							arr.push('</div>');
							arr.push('<div class="mess_pl">'+board.replayContent+'</div>');
							arr.push('<div class="mess_pl mess_time">'+board.replayTime.substr(0,10)+'</div>');
							arr.push('</div>');
							arr.push('<div class="btnbuy" onclick="hide_board(2,\''+board.commodityId+'\',\''+board.channelId+'\',\'_msg_board'+board.id+'\');">删除</div>');
							arr.push('</div>');
						}
					}
					$("#list_div").html(arr.join(''));
				}
			}
		});
	}
	if(result!="")
	{
		//result = eval('('+ result +')');
		result = JSON.parse(result);
		if(result.result == 1){
			if(result.data.boardList.length < 1){
				$("#message_none_div").show();
			}else{
				var arr = new Array("");
				for( var i in result.data.boardList){
					var board = result.data.boardList[i];
					if(board.orderId != null){
						arr.push('<div class="good2G good" id="_msg_board'+board.id+'">');
						arr.push('<div class="in_goodimg" onclick="goto_board(1,\''+board.orderId+'\',\''+board.channelId+'\');">');
						arr.push('<img src="'+board.commodityIcon+'">');
						arr.push('<span class="mess_num mess_munwz">'+$.num_N(board.unReadNum)+'</span>');
						arr.push('</div>');
						arr.push('<div class="in_gooddescribe" onclick="goto_board(1,\''+board.orderId+'\',\''+board.channelId+'\');">');
						arr.push('<div class="title gooddiv goodtit">');
						arr.push('<b>'+board.commodityName+'</b>');
						arr.push('</div>');
						arr.push('<div class="mess_pl">'+board.replayContent+'</div>');
						arr.push('<div class="mess_pl mess_time">'+board.replayTime.substr(0,10)+'</div>');
						arr.push('</div>');
						arr.push('<div class="btnbuy" onclick="hide_board(1,\''+board.orderId+'\',\''+board.channelId+'\',\'_msg_board'+board.id+'\');">删除</div>');
						arr.push('</div>');
					}else{
						arr.push('<div class="good2G good" id="_msg_board'+board.id+'">');
						arr.push('<div class="in_goodimg" onclick="goto_board(2,\''+board.commodityId+'\',\''+board.channelId+'\');">');
						arr.push('<img src="'+board.commodityIcon+'">');
						arr.push('<span class="mess_num mess_munwz">'+$.num_N(board.unReadNum)+'</span>');
						arr.push('</div>');
						arr.push('<div class="in_gooddescribe" onclick="goto_board(2,\''+board.commodityId+'\',\''+board.channelId+'\');">');
						arr.push('<div class="title gooddiv goodtit">');
						arr.push('<b>'+board.commodityName+'</b>');
						arr.push('</div>');
						arr.push('<div class="mess_pl">'+board.replayContent+'</div>');
						arr.push('<div class="mess_pl mess_time">'+board.replayTime.substr(0,10)+'</div>');
						arr.push('</div>');
						arr.push('<div class="btnbuy" onclick="hide_board(2,\''+board.commodityId+'\',\''+board.channelId+'\',\'_msg_board'+board.id+'\');">删除</div>');
						arr.push('</div>');
					}
				}
				$("#list_div").html(arr.join(''));
			}
		}
	}
}

$(function(){
	get_board_list();
});

</script>
</body>
</html>