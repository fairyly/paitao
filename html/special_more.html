<!DOCTYPE html>
<html>
<head>
<title>特卖专区</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<link rel="stylesheet" href="css/new_base_style.css" type="text/css" />
</head>
<body>
<div class="banner">
	<h1><span id="price"></span></h1>
	<a class="btnr">
		<div  onclick="history.go(-1);" >返回</div></a>
			<a class="btna" href="Login.html" id="login_none" >
			<div class="refreshbtnbg" >登录</div>
		</a>
		<a class="btna" href="javascript:goto_shopping_cart('$.get_path()');" id="login_had" style="display: none;">
			<div class="refreshbtnbg"><img src="img/shopcar.png">
				<span class="shopcarnum" id="shopping_cart_num">0</span>
			</div>
		</a>
</div>
<div class="special_list" id="special_info">
</div>

<script src="js/jq.js"></script>
<script src="js/jquery.common.js"></script>
<script type="text/javascript">
var pageSize = 12;
var pageNo = 1;
var isNextPage = true;
var channel;
var activateNumber;
try{
	channel = window.myAndroidJs.getChannel();
	activateNumber = window.myAndroidJs.getActivateNumber();
}catch (e) {
}

function special_group_list(loadType){
	if(!isNextPage){
		return ;
	}
	//加载第一页数据(刚打开页面的时候)
	if(loadType == 1){
		pageNo = 1;
	}else if(loadType == 2){
		//加载下一页数据
		pageNo = pageNo + 1;
	}

	var result="";
  	try{
  		result = window.myAndroidJs.doPostHttpRequest($.get_path("market?type=171&id="+$.get_param('id')+"&pageSize="+pageSize+"&pageNo="+pageNo+""));
  	}catch (e) {
  		$.getJSON("http://api.wedanke.com/server/market?jsoncallback=?",{
		   type : 171,
		   id : $.get_param('id'),
		   pageSize : pageSize,
		   pageNo : pageNo
		},function(result){
			if(result.result == "1"){
				var arr = new Array();
				if(result.data.length < 1){
					isNextPage = false;
					return ;
				}
				for ( var j in result.data) {
					var goods = result.data[j];
					if(j % 2 == 0){
						arr.push("<div class=\"special_row\">");
						arr.push("<div class=\"special_left\">");
					}else{
						arr.push("<div class=\"special_right\">");
					}
					arr.push("<p class=\"special_name\">");
					arr.push(goods.name);
					arr.push("</p><div class=\"special_img\">");
					arr.push("<img onclick=\"goToSoft('"+goods.softId+"')\" src=\"");
					arr.push(goods.samllPicture);
					arr.push("\"></div>");
					arr.push("<div class=\"special_bottom\">");
					arr.push("<span class=\"special_price\">￥");
					arr.push(goods.currentPrice);
					arr.push("</span><span class=\"special_mun\"><del>￥");
					arr.push(goods.originalPrice);
					arr.push("</del></span></div></div>");
					if(j % 2 != 0 || j == result.data.length - 1){
						arr.push("</div>");
					}
				}
				$("#special_info").append(arr.join(""));
			}
		});
	}
	if(result!="")
	{
		//result = eval('('+ result +')');
		result = JSON.parse(result);
		if(result.result == "1"){
			var arr = new Array();
			if(result.data.length < 1){
				isNextPage = false;
				return ;
			}
			for ( var j in result.data) {
				var goods = result.data[j];
				if(j % 2 == 0){
					arr.push("<div class=\"special_row\">");
					arr.push("<div class=\"special_left\">");
				}else{
					arr.push("<div class=\"special_right\">");
				}
				arr.push("<p class=\"special_name\">");
				arr.push(goods.name);
				arr.push("</p><div class=\"special_img\">");
				arr.push("<img onclick=\"goToSoft('"+goods.softId+"')\" src=\"");
				arr.push(goods.samllPicture);
				arr.push("\"></div>");
				arr.push("<div class=\"special_bottom\">");
				arr.push("<span class=\"special_price\">￥");
				arr.push(goods.currentPrice);
				arr.push("</span><span class=\"special_mun\"><del>￥");
				arr.push(goods.originalPrice);
				arr.push("</del></span></div></div>");
				if(j % 2 != 0 || j == result.data.length - 1){
					arr.push("</div>");
				}
			}
			$("#special_info").append(arr.join(""));
		}
	}
}
function getSpecialName(id){
	var result="";
  	try{
  		result = window.myAndroidJs.doPostHttpRequest($.get_path("market?type=178&id="+id+""));
  	}catch (e) {
  		$.getJSON("http://api.wedanke.com/server/market?jsoncallback=?",{
		   type : 178,
		   id : id
		},function(result){
			if(result.result == "1"){
				$("#price").html(result.data.name)
			}
		});
	}
	if(result!="")
	{
		//result = eval('('+ result +')');
		result = JSON.parse(result);
		if(result.result == "1"){
			$("#price").html(result.data.name)
			//alert(json.data.name)
		}
	}
}

function goToSoft(id){
	window.localStorage.setItem("new_goods_view.html","new_goods_view.html?id=" + id);
	//window.location.href="new_goods_view.html?id=" + id;
	window.location.href="new_goods_view.html";
}

$(function(){
	$.loadLoginStatus();
	$.show_shopping_cart_num($.get_path());
	//id 178
	var _special_id = $.get_param('id');
	if(_special_id == null || _special_id == ''){
		alert('没有这个特卖专区');
	}else{
		getSpecialName(_special_id);
		special_group_list(1);
	}
	$(window).scroll(function() {  
		var a = document.documentElement.clientHeight;
		var b = document.documentElement.scrollTop==0? document.body.scrollTop : document.documentElement.scrollTop;
		var c = document.documentElement.scrollTop==0? document.body.scrollHeight : document.documentElement.scrollHeight;
		if(a+b>=c-2){
			special_group_list(2);
		}
	});  
});
</script>
</body>
</html>