
<!DOCTYPE html>
<html>
<head>
<title>密码修改</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<link rel="stylesheet" href="css/base_style.css" type="text/css" />
</head>
<body bgcolor="#F4F4EC">
	<div class="banner">
		<h1>密码修改</h1>
			<a class="btnr">
			<div onclick="history.go(-1);" >返回</div></a>
		</a>
	</div>
   	<section class="login" >
	<form id="J_login_form" name="form" method="post" style="margin-top:60px" >
		<div class="login-frame">
			<ul>
				<li><p>旧密码</p>
					<p><input id="J_oldpassword" name="oldpassword" type="password" class="log-inp" placeholder="请输入旧密码"  /></p>
				</li>
				<li><p>新密码</p>
					<p><input id="J_newpassword" name="newpassword" type="password" class="log-inp" placeholder="请输入新密码"/></p>
				</li>
				
				<li><p>确认密码</p>
					<p><input id="J_repassword" name="repassword" type="password" class="log-inp" placeholder="请再次输入新密码"/></p>
				</li>
			</ul>
		</div>
	</form>
	<div id="Mes"></div>
	<a id="J_submit" href="javascript:;" class="down-btn" style="text-decoration: none;margin-bottom: 78px;width:90%">修改</a>	
</section>

<script  src="js/jq.js"></script>
<script src="js/jquery.common.js"></script>
<script type="text/javascript">
$(document).ready(function(){
$("#J_submit").click( function() { 
	  var oldpassword = $("#J_oldpassword"),
	      newpassword = $("#J_newpassword"),
	      repassword  = $("#J_repassword");
	  var username = window.localStorage.getItem("_user_name");
	  if(username == ''){
		  alert('请先登录');
		  return false;
	  }
	  if(oldpassword.val()==""){
		$("#Mes").html("请输入旧密码！").show(300).delay(2000).hide(300);
		return false;
	  }
	  if(newpassword.val()==""){
		$("#Mes").html("请输入新密码！").show(300).delay(2000).hide(300); 
		return false;
	  }
	  if(repassword.val()==""){
		$("#Mes").html("请输入确认密码！").show(300).delay(2000).hide(300); 
		return false;
	  }
	 if(!checkPassword(oldpassword)){
		 return false;
	 }
	 if(!checkPassword(newpassword)){
		 return false;
	 }
	 if(!checkPassword(repassword)){
		 return false;
	 }
	 if(newpassword.val()!=repassword.val()){
		$("#Mes").html("两次输入密码不一致！").show(300).delay(2000).hide(300); 
		return false; 
	 }
	var result="";
  	try{
  		result = window.myAndroidJs.doPostHttpRequest($.get_path("market?type=177&username="+username+"&oldpwd="+oldpassword.val()+"&newpwd="+repassword.val()+""))
  	}catch (e) {
  		$.getJSON("http://api.wedanke.com/server/market?jsoncallback=?",{
		   type : 177,
		   username : username,
		   oldpwd : oldpassword.val(),
		   newpwd : repassword.val()
		},function(result){
			if(result.result == 1){
				window.localStorage.setItem("_user_pwd",repassword.val());
				//$.cookie('_user_pwd',repassword.val(),{ expires: (24*60), path: '/' }); 
				//修改成功后跳转
				 window.location.href="5.html";
			}else{
				$("#Mes").html(result.msg).show(300).delay(2000).hide(300);
			}
		});
	}
	if(result!="")
	{
		//result = eval('('+ result +')');
		result = JSON.parse(result);
		if(result.result == 1){
			window.localStorage.setItem("_user_pwd",repassword.val());
			//$.cookie('_user_pwd',repassword.val(),{ expires: (24*60), path: '/' }); 
			//修改成功后跳转
			 window.location.href="5.html";
		}else{
			$("#Mes").html(result.msg).show(300).delay(2000).hide(300);
		}
	}
});
});
function checkPassword (password) {
	var checkPsw = true;
	if (hasElement(password)) {
		var pswVal = $.trim(password.val());
     if (!/^.{6,32}$/.test(pswVal)) {
			$("#Mes").html("密码长度必须为6-32字符").show(300).delay(2000).hide(300);
			checkPsw = false;
		}
	}
	return checkPsw;
}
function hasElement (ele) {
	return (ele.length > 0);
}
</script>
</body>
</html>