<!DOCTYPE HTML >
<html>
<head>
<title>首页</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<link rel="stylesheet" href="css/base_style.css" type="text/css"/>
</head>
<body id="bodyshouye">

<div id="notNetwork" style="display: none;" onclick="reloadCurrentPage()">
	
	<div style="margin-top: 40%;">
		<img src="img/nonetwork.png" style="width:70%;margin-left: 15%">
	</div>
	<p style="color:#d66a24;font-family: 微软雅黑;width: 100%;text-align: center;">亲，您的网络不给力！请检查一下网络设置</p>
	
</div>

<div id="bodyHtml">
	<!--顶部条-->
	<div class="banner">
		<h1>拍淘购物</h1>
		<a class="btna" href="Login.html" id="login_none" >
			<div class="refreshbtnbg" >登录</div>
		</a>
		<a class="btna" href="javascript:$.goto_shopping_cart('$.get_path()');" id="login_had" style="display: none;">
			<div class="refreshbtnbg"><img src="img/shopcar.png">
				<span class="shopcarnum" id="shopping_cart_num">0</span>
			</div>
		</a>
	</div>
	<!--广告条-->
	<div id='mySwipe' class='swipe'>
			<div class='swipe-wrap' id="swipe-wrap">
				<div><img src="img/default_advert.jpg" alt="拍淘" class="js-hisAutoInfo focus_img"></div>
			</div>
	</div>
	<!--商品-->
	<div class="main" id="goods_content">
		<P style="width:100%;text-align: center;">数据加载中……</p>
	</div>
	
</div>
<script type="text/javascript" src="js/bottom.js"></script>
<script src="js/jq.js"></script>
<script src="js/jquery.common.js" defer></script><!--延时加载，包含document.write不可用-->
<script src='js/swipe.js'></script>
<script type="text/javascript">
//没有网络的时候调用
function notNetwork(){

	$("#bodyHtml").hide();
	$("#notNetwork").show();

}

if(window.myAndroidJs!==undefined){
	if(!window.myAndroidJs.checkNetwork()){
		notNetwork();
	}
}
//防止返回到其它activity
function reloadCurrentPage(){
	
	window.myAndroidJs.woringNetwork(window.location.href + "");

}
//获取广告条数据
function loadadvertfromweb(){
  	var result="";
  	try{
  		result = window.myAndroidJs.doPostHttpRequest($.get_path("market?type=149&typeId=1&userId=366623"))
  	}catch (e) {
  		$.getJSON("http://api.wedanke.com/server/market?jsoncallback=?",{
			"type" : "149",
			"typeId" : "1",
			"userId" : "366623",
		},function(result){
			var advertList = result.data;
			$("#swipe-wrap").html("");
			for(var j = 0 ;j < advertList.length;j++){
				var advert = advertList[j];
				$("#swipe-wrap").append("<div id=\"advertorder"+j+"\"><a href=\" "+ advert.toLink + "\"><img class=\"lazy\" width=\""+$(window).width()+"\" height=\"124\" style=\"display: block;\" src=\"img/default_advert.jpg\" data-original=\"" + advert.fileName + "\" /></a></div>");
				if(j == advertList.length-1){
					var elem = document.getElementById('mySwipe');
					var mySwipe = Swipe(elem, {
					  	 auto: 3000,
					  	 continuous: true
						});
				}
			};
		});
	}
	if(result!="")
	{
		//localStorage.setItem("advert",result);
		//result = eval('('+ result +')');//用JSON.parse代替eval result = JSON.parse(result);
		result = JSON.parse(result);
		var advertList = result.data;
		$("#swipe-wrap").html("");
			for(var j = 0 ;j < advertList.length;j++){
				var advert = advertList[j];
				$("#swipe-wrap").append("<div id=\"advertorder"+j+"\"><a href=\" "+ advert.toLink + "\"><img class=\"lazy\" width=\""+$(window).width()+"\" height=\"124\" style=\"display: block;\" src=\"img/default_advert.jpg\" data-original=\"" + advert.fileName + "\" /></a></div>");
				if(j == advertList.length-1){
					var elem = document.getElementById('mySwipe');
					var mySwipe = Swipe(elem, {
					  	 auto: 3000,
					  	 continuous: true
						});
				}
			};
	}	
	loadData();//加载图片
}

//获取商品数据
function loadfromweb(type){
  	var result="";
  	try{
  		result = window.myAndroidJs.doPostHttpRequest($.get_path("market?type=130"));
  	}catch (e) {
  		$.getJSON("http://api.wedanke.com/server/market?jsoncallback=?",{
		  "type" : "130"
		},function(result){
				var res = result.data;
				$('#goods_content').html('');
				for(var i = 0 ;i < res.length;i++){
					var info = res[i];
					var html = getHtmlByInfo(info,1);
					$('#goods_content').append(html);
				}
			loadData();//加载图片
		});
	}
	if(result!="")
	{
		//result = eval('('+ result +')');
		result = JSON.parse(result);
		var res = result.data;
		$('#goods_content').html('');
		for(var i = 0 ;i < res.length;i++){
			var info = res[i];
			var html = getHtmlByInfo(info,1);
			$('#goods_content').append(html);
		}
		loadData();//加载图片
	}
}

function getHtmlByInfo(info,type){//type用于控制倒计时
	var id = info.id;
	var title = info.title;
	//title = title.substring(0,10);
	var thumbnail = info.thumbnail;
	thumbnail = "http://res.wemedias.com:8080/client/upload/taoicon/"+thumbnail;
	var discount = info.discount;
	discount = Math.floor(discount);
	var current_price = info.current_price;
	var original_price = info.original_price;
	var inventory = info.inventory;
	var t = info.timen;
	if(t==null){
		t = 0;
	} 
	return "<div class=\"shouye_good\" onclick=\"goToSoft("+ id + ")\">"+
		"<div class=\"goodleft\">"+
		"<div class=\"goodimg_wi\">"+
		"<img src=\"img/grey.gif\" class='lazy'  style='display: block;'  data-original=\""+thumbnail+"\" />"+
		"</div>"+
		"</div>"+
		"<div class=\"goodright\">"+
		"<div class=\"title\">"+title+"</div>"+
		"<div class=\"now_price\">"+"￥"+"<span>"+current_price+"</span>"+"</div>"+
		"<div class=\"orig_price\"><del>"+original_price+"</del></div>"+
		"<div class=\"btnbuy_wifi\">"+"立即抢购"+"</div>"+
		"<div class=\" price_num\">已售"+inventory+"件</div>"+
		"<div class=\"time_wi\" id=\""+id+"\"></div>"+
		"</div>"+"</div>"+
		"<script>show_date_time("+t+"," +id+ ",1);<\/script>";
}
	
function goToSoft(id){
	window.localStorage.setItem("new_goods_view.html","new_goods_view.html?id=" + id);
	window.location.href="new_goods_view.html";
}
	
function show_date_time(timen, id,type) {
	timeold = timen;
	http: timen = timen - 1000;
	if(type==1)
		window.setTimeout("show_date_time(" + timen + "," + id + ","+type+")", 1000);
	sectimeold = timeold / 1000;
	secondsold = Math.floor(sectimeold);
	msPerDay = 24 * 60 * 60 * 1000;
	e_daysold = timeold / msPerDay;
	daysold = Math.floor(e_daysold);
	e_hrsold = (e_daysold - daysold) * 24;
	hrsold = Math.floor(e_hrsold);
	e_minsold = (e_hrsold - hrsold) * 60;
	minsold = Math.floor((e_hrsold - hrsold) * 60);
	seconds = Math.floor((e_minsold - minsold) * 60);
	if (daysold < 0) {
		daysold = 0;
		hrsold = 0;
		minsold = 0;
		seconds = 0;
	}
	$("#" + id).html("倒计时：" + hrsold + ":" + minsold + ":"+ seconds);
}
	
//加载图片
function loadData(){
	$(".lazy").each(function(){
		var src=$(this).attr("src");
		var temp=$(this).attr("data-original");
		if(src!=temp)
		$(this).attr("src",temp);
	}); 
}
//dom加载后执行
$(document).ready(function(){ 
	loadData();
	setTimeout(loadadvertfromweb,1);
	setTimeout(loadfromweb,1);
	localStorage.setItem("isFirstStart","true");
	$.doClearHistory();
	$.loadLoginStatus();
	$.show_shopping_cart_num($.get_path());
});

</script>
<!--
<script type="text/javascript">function a(){alert(1)}//申明 不执行</script>
<script type="text/javascript">a()//调用 执行</script>
-->
</body>
</html>
